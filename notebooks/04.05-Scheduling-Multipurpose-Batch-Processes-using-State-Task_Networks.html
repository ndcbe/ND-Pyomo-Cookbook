
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4.5. Scheduling Multipurpose Batch Processes using State-Task Networks &#8212; ND Pyomo Cookbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/04.05-Scheduling-Multipurpose-Batch-Processes-using-State-Task_Networks';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.6. Unit Commitment" href="04.06-Unit-Commitment.html" />
    <link rel="prev" title="4.4. Maintenance Planning" href="04.04-Maintenance-Planning.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/Kondili_1993.png" class="logo__image only-light" alt="ND Pyomo Cookbook - Home"/>
    <img src="../_static/Kondili_1993.png" class="logo__image only-dark pst-js-only" alt="ND Pyomo Cookbook - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    ND Pyomo Cookbook
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="01.00-Getting-Started-with-Pyomo.html">1. Getting Started with Pyomo</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="01.01-Installing-Pyomo.html">1.1. Installing a Pyomo/Python Development Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="01.02-Running-Pyomo-on-Google-Colab.html">1.2. Running Pyomo on Google Colab</a></li>
<li class="toctree-l2"><a class="reference internal" href="01.03-Running-Pyomo-on-the-Notre-Dame-CRC-Cluster.html">1.3. Running Pyomo on the Notre Dame CRC Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="01.04-Cross-Platform-Installation-of-Pyomo-and-Solvers.html">1.4. Cross-Platform Installation of Pyomo and Solvers</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="02.00-Linear-Programming.html">2. Linear Programming</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="02.01-Production-Models-with-Linear-Constraints.html">2.1. Production Models with Linear Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.02-Production-Model-Sensitivity-Analysis.html">2.2. Production Model Sensitivity Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.03-Linear-Blending-Problem.html">2.3. Linear Blending Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.04-Mixture-Design-Cold-Weather-Fuel.html">2.4. Design of a Cold Weather Fuel for a Camping Stove</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.05-Gasoline-Blending.html">2.5. Gasoline Blending</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.06-Model-Predictive-Control-of-a-Double-Integrator.html">2.6. Model Predictive Control of a Double Integrator</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.07-Non-Continuous-Objective.html">2.7. Non-Continuous Objectives</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="03.00-Assignment-Problems.html">3. Assignment Problems</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="03.01-Transportation-Networks.html">3.1. Transportation Networks</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="04.00-Scheduling-with-Disjunctive-Constraints.html">4. Scheduling with Disjunctive Constraints</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="04.01-Introduction_to_Disjunctive_Programming.html">4.1. Introduction to Disjunctive Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.02-Machine-Bottleneck.html">4.2. Machine Bottleneck</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.03-Job-Shop-Scheduling.html">4.3. Job Shop Scheduling</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.04-Maintenance-Planning.html">4.4. Maintenance Planning</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">4.5. Scheduling Multipurpose Batch Processes using State-Task Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.06-Unit-Commitment.html">4.6. Unit Commitment</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="05.00-Simulation.html">5. Simulation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="05.01-Response-of-a-First-Order-System-to-Step-and-Square-Wave-Inputs.html">5.1. Response of a First Order System to Step and Square Wave Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="05.02-Exothermic-CSTR.html">5.2. Exothermic CSTR</a></li>
<li class="toctree-l2"><a class="reference internal" href="05.03-Heat_Conduction_in_Various_Geometries.html">5.3. Transient Heat Conduction in Various Geometries</a></li>
<li class="toctree-l2"><a class="reference internal" href="05.04-Diffusion_Adsorption_in_Polymers.html">5.4. Diffusion with Adsorption in Polymers</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="06.00-Differential-Algebraic-Equations.html">6. Differential-Algebraic Equations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="06.01-Unconstrained-Scalar-Optimization.html">6.1. Unconstrained Scalar Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="06.02-Maximizing-Concentration-of-an-Intermediate-in-a-Batch-Reactor.html">6.2. Maximizing Concentration of an Intermediate in a Batch Reactor</a></li>
<li class="toctree-l2"><a class="reference internal" href="06.03-Path-Planning-for-a-Simple-Car.html">6.3. Path Planning for a Simple Car</a></li>
<li class="toctree-l2"><a class="reference internal" href="06.04-Soft-Landing-Apollo-11-on-the-Moon.html">6.4. Soft Landing Apollo 11 on the Moon</a></li>
<li class="toctree-l2"><a class="reference internal" href="06.05-Launching-Apollo-11-from-the-Moon.html">6.5. Ascent from Lunar Surface</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="07.00-Parameter-Estimation.html">7. Parameter Estimation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="07.01-Parameter-Estimation-Catalytic-Reactor.html">7.1. Parameter estimation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="08.00-Financial-Applications.html">8. Financial Applications</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="08.01-Obtaining-Historical-Stock_-ata.html">8.1. Obtaining Historical Stock Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="08.02-Consolidating-and-Charting-Stock-Data.html">8.2. Consolidating and Charting Stock Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="08.03-Binomial-Model-for-Pricing-Options.html">8.3. Binomial Model for Pricing Options</a></li>

<li class="toctree-l2"><a class="reference internal" href="08.04-MAD-Portfolio-Optimization.html">8.5. MAD Portfolio Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="08.05-Real-Options.html">8.6. Real Options</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="09.00-pyomo-coding-guide.html">9. Guide to Coding with Pyomo</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="09.01-notebook-style-guide.html">9.1. Notebook Style Guide</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/ndcbe/ND-Pyomo-Cookbook/blob/main/notebooks/04.05-Scheduling-Multipurpose-Batch-Processes-using-State-Task_Networks.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ndcbe/ND-Pyomo-Cookbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ndcbe/ND-Pyomo-Cookbook/issues/new?title=Issue%20on%20page%20%2Fnotebooks/04.05-Scheduling-Multipurpose-Batch-Processes-using-State-Task_Networks.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/04.05-Scheduling-Multipurpose-Batch-Processes-using-State-Task_Networks.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Scheduling Multipurpose Batch Processes using State-Task Networks</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">4.5.1. Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">4.5.2. References</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-kondili-et-al-1993">4.5.3. Example (Kondili, et al., 1993)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">4.5.3.1. Exercise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#encoding-the-stn-data">4.5.4. Encoding the STN data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-a-time-grid">4.5.4.1. Setting a time grid</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-pyomo-model">4.5.5. Creating a Pyomo model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#characterization-of-tasks">4.5.5.1. Characterization of tasks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#characterization-of-states">4.5.5.2. Characterization of states</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#characterization-of-units">4.5.5.3. Characterization of units</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pyomo-model">4.5.5.4. Pyomo model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis">4.5.6. Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#profitability">4.5.6.1. Profitability</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unit-assignment">4.5.6.2. Unit assignment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#state-inventories">4.5.6.3. State inventories</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unit-batch-inventories">4.5.6.4. Unit batch inventories</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gannt-chart">4.5.6.5. Gannt chart</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#trace-of-events-and-states">4.5.7. Trace of events and states</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="scheduling-multipurpose-batch-processes-using-state-task-networks">
<h1><span class="section-number">4.5. </span>Scheduling Multipurpose Batch Processes using State-Task Networks<a class="headerlink" href="#scheduling-multipurpose-batch-processes-using-state-task-networks" title="Link to this heading">#</a></h1>
<p>Keywords: cbc usage, state-task networks, gdp, disjunctive programming, batch processes</p>
<p>The State-Task Network (STN) is an approach to modeling multipurpose batch process for the purpose of short term scheduling. It was first developed by Kondili, et al., in 1993, and subsequently developed and extended by others.</p>
<section id="imports">
<h2><span class="section-number">4.5.1. </span>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
    
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os.path</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;pyomo&quot;</span><span class="p">):</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>-q<span class="w"> </span>pyomo
    <span class="k">assert</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;pyomo&quot;</span><span class="p">))</span>

<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;cbc&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;cbc&quot;</span><span class="p">)):</span>
    <span class="k">if</span> <span class="s2">&quot;google.colab&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
        <span class="o">!</span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-qq<span class="w"> </span>coinor-cbc
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="o">!</span>conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>coincbc<span class="w"> </span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="k">assert</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;cbc&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;cbc&quot;</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="references">
<h2><span class="section-number">4.5.2. </span>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<p>Floudas, C. A., &amp; Lin, X. (2005). Mixed integer linear programming in process scheduling: Modeling, algorithms, and applications. Annals of Operations Research, 139(1), 131-162.</p>
<p>Harjunkoski, I., Maravelias, C. T., Bongers, P., Castro, P. M., Engell, S., Grossmann, I. E., … &amp; Wassick, J. (2014). Scope for industrial applications of production scheduling models and solution methods. Computers &amp; Chemical Engineering, 62, 161-193.</p>
<p>Kondili, E., Pantelides, C. C., &amp; Sargent, R. W. H. (1993). A general algorithm for short-term scheduling of batch operations—I. MILP formulation. Computers &amp; Chemical Engineering, 17(2), 211-227.</p>
<p>Méndez, C. A., Cerdá, J., Grossmann, I. E., Harjunkoski, I., &amp; Fahl, M. (2006). State-of-the-art review of optimization methods for short-term scheduling of batch processes. Computers &amp; Chemical Engineering, 30(6), 913-946.</p>
<p>Shah, N., Pantelides, C. C., &amp; Sargent, R. W. H. (1993). A general algorithm for short-term scheduling of batch operations—II. Computational issues. Computers &amp; Chemical Engineering, 17(2), 229-244.</p>
<p>Wassick, J. M., &amp; Ferrio, J. (2011). Extending the resource task network for industrial applications. Computers &amp; chemical engineering, 35(10), 2124-2140.</p>
</section>
<section id="example-kondili-et-al-1993">
<h2><span class="section-number">4.5.3. </span>Example (Kondili, et al., 1993)<a class="headerlink" href="#example-kondili-et-al-1993" title="Link to this heading">#</a></h2>
<p>A state-task network is a graphical representation of the activities in a multi-product batch process. The representation includes the minimum details needed for short term scheduling of batch operations.</p>
<p>A well-studied example due to Kondili (1993) is shown below. Other examples are available in the references cited above.</p>
<p><img alt="Kondili_1993.png" src="https://github.com/jckantor/ND-Pyomo-Cookbook/blob/master/notebooks/figures/Kondili_1993.png?raw=1" /></p>
<p>Each circular node in the diagram designates material in a particular state.  The materials are generally held in suitable vessels with a known capacity. The relevant information for each state is the initial inventory, storage capacity, and the unit price of the material in each state. The price of materials in intermediate states may be assigned penalties in order to minimize the amount of work in progress.</p>
<p>The rectangular nodes denote process tasks. When scheduled for execution, each task is assigned an appropriate piece of equipment, and assigned a batch of material according to the incoming arcs. Each incoming arc begins at a state where the associated label indicates the mass fraction of the batch coming from that particular state. Outgoing arcs indicate the disposition of the batch to product states. The outgoing are labels indicate the fraction of the batch assigned to each product state, and the time necessary to produce that product.</p>
<p>Not shown in the diagram is the process equipment used to execute the tasks. A separate list of process units is available, each characterized by a capacity and list of tasks which can be performed in that unit.</p>
<section id="exercise">
<h3><span class="section-number">4.5.3.1. </span>Exercise<a class="headerlink" href="#exercise" title="Link to this heading">#</a></h3>
<p>Read this recipe for Hollandaise Sauce: <a class="reference external" href="http://www.foodnetwork.com/recipes/tyler-florence/hollandaise-sauce-recipe-1910043">http://www.foodnetwork.com/recipes/tyler-florence/hollandaise-sauce-recipe-1910043</a>. Assume the available equipment consists of one sauce pan and a double-boiler on a stove. Draw a state-task network outlining the basic steps in the recipe.</p>
</section>
</section>
<section id="encoding-the-stn-data">
<h2><span class="section-number">4.5.4. </span>Encoding the STN data<a class="headerlink" href="#encoding-the-stn-data" title="Link to this heading">#</a></h2>
<p>The basic data structure specifies the states, tasks, and units comprising a state-task network. The intention is for all relevant problem data to be contained in a single JSON-like structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># planning horizon</span>
<span class="n">H</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">Kondili</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># time grid</span>
    <span class="s1">&#39;TIME&#39;</span><span class="p">:</span>  <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">H</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
    
    <span class="c1"># states</span>
    <span class="s1">&#39;STATES&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Feed_A&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span>  <span class="mi">0</span><span class="p">},</span>
        <span class="s1">&#39;Feed_B&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span>  <span class="mi">0</span><span class="p">},</span>
        <span class="s1">&#39;Feed_C&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span>  <span class="mi">0</span><span class="p">},</span>
        <span class="s1">&#39;Hot_A&#39;</span>    <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">},</span>
        <span class="s1">&#39;Int_AB&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">},</span>
        <span class="s1">&#39;Int_BC&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">},</span>
        <span class="s1">&#39;Impure_E&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">},</span>
        <span class="s1">&#39;Product_1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
        <span class="s1">&#39;Product_2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
    <span class="p">},</span>
    
    <span class="c1"># state-to-task arcs indexed by (state, task)</span>
    <span class="s1">&#39;ST_ARCS&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">(</span><span class="s1">&#39;Feed_A&#39;</span><span class="p">,</span>   <span class="s1">&#39;Heating&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Feed_B&#39;</span><span class="p">,</span>   <span class="s1">&#39;Reaction_1&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Feed_C&#39;</span><span class="p">,</span>   <span class="s1">&#39;Reaction_1&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Feed_C&#39;</span><span class="p">,</span>   <span class="s1">&#39;Reaction_3&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Hot_A&#39;</span><span class="p">,</span>    <span class="s1">&#39;Reaction_2&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Int_AB&#39;</span><span class="p">,</span>   <span class="s1">&#39;Reaction_3&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Int_BC&#39;</span><span class="p">,</span>   <span class="s1">&#39;Reaction_2&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Impure_E&#39;</span><span class="p">,</span> <span class="s1">&#39;Separation&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
    <span class="p">},</span>
    
    <span class="c1"># task-to-state arcs indexed by (task, state)</span>
    <span class="s1">&#39;TS_ARCS&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">(</span><span class="s1">&#39;Heating&#39;</span><span class="p">,</span>    <span class="s1">&#39;Hot_A&#39;</span><span class="p">)</span>    <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reaction_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Product_1&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reaction_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Int_AB&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reaction_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Int_BC&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reaction_3&#39;</span><span class="p">,</span> <span class="s1">&#39;Impure_E&#39;</span><span class="p">)</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Separation&#39;</span><span class="p">,</span> <span class="s1">&#39;Int_AB&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Separation&#39;</span><span class="p">,</span> <span class="s1">&#39;Product_2&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">},</span>
    <span class="p">},</span>
    
    <span class="c1"># unit data indexed by (unit, task)</span>
    <span class="s1">&#39;UNIT_TASKS&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">(</span><span class="s1">&#39;Heater&#39;</span><span class="p">,</span>    <span class="s1">&#39;Heating&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_1&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_2&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_3&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_1&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_2&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_3&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Still&#39;</span><span class="p">,</span>     <span class="s1">&#39;Separation&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">STN</span> <span class="o">=</span> <span class="n">Kondili</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">H</span> <span class="o">=</span> <span class="mi">16</span>

<span class="n">Hydrolubes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># time grid</span>
    <span class="s1">&#39;TIME&#39;</span><span class="p">:</span>  <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">H</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
    
    <span class="c1"># states</span>
    <span class="s1">&#39;STATES&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Feed_A&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span>  <span class="mi">0</span><span class="p">},</span>
        <span class="s1">&#39;Feed_B&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span>  <span class="mi">0</span><span class="p">},</span>
        <span class="s1">&#39;Feed_C&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span>  <span class="mi">0</span><span class="p">},</span>
        <span class="s1">&#39;Hot_A&#39;</span>    <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">},</span>
        <span class="s1">&#39;Int_AB&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">},</span>
        <span class="s1">&#39;Int_BC&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">},</span>
        <span class="s1">&#39;Impure_E&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">},</span>
        <span class="s1">&#39;Product_1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
        <span class="s1">&#39;Product_2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
    <span class="p">},</span>
    
    <span class="c1"># state-to-task arcs indexed by (state, task)</span>
    <span class="s1">&#39;ST_ARCS&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">(</span><span class="s1">&#39;Feed_A&#39;</span><span class="p">,</span>   <span class="s1">&#39;Heating&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Feed_B&#39;</span><span class="p">,</span>   <span class="s1">&#39;Reaction_1&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Feed_C&#39;</span><span class="p">,</span>   <span class="s1">&#39;Reaction_1&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Feed_C&#39;</span><span class="p">,</span>   <span class="s1">&#39;Reaction_3&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Hot_A&#39;</span><span class="p">,</span>    <span class="s1">&#39;Reaction_2&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Int_AB&#39;</span><span class="p">,</span>   <span class="s1">&#39;Reaction_3&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Int_BC&#39;</span><span class="p">,</span>   <span class="s1">&#39;Reaction_2&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Impure_E&#39;</span><span class="p">,</span> <span class="s1">&#39;Separation&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
    <span class="p">},</span>
    
    <span class="c1"># task-to-state arcs indexed by (task, state)</span>
    <span class="s1">&#39;TS_ARCS&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">(</span><span class="s1">&#39;Heating&#39;</span><span class="p">,</span>    <span class="s1">&#39;Hot_A&#39;</span><span class="p">)</span>    <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reaction_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Product_1&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reaction_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Int_AB&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reaction_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Int_BC&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reaction_3&#39;</span><span class="p">,</span> <span class="s1">&#39;Impure_E&#39;</span><span class="p">)</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Separation&#39;</span><span class="p">,</span> <span class="s1">&#39;Int_AB&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Separation&#39;</span><span class="p">,</span> <span class="s1">&#39;Product_2&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">},</span>
    <span class="p">},</span>
    
    <span class="c1"># unit data indexed by (unit, task)</span>
    <span class="s1">&#39;UNIT_TASKS&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">(</span><span class="s1">&#39;Heater&#39;</span><span class="p">,</span>    <span class="s1">&#39;Heating&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_1&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_2&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_3&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_1&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_2&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_3&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Still&#39;</span><span class="p">,</span>     <span class="s1">&#39;Separation&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">STN</span> <span class="o">=</span> <span class="n">Hydrolubes</span>
</pre></div>
</div>
</div>
</div>
<section id="setting-a-time-grid">
<h3><span class="section-number">4.5.4.1. </span>Setting a time grid<a class="headerlink" href="#setting-a-time-grid" title="Link to this heading">#</a></h3>
<p>The following computations can be done on any time grid, including real-valued time points. TIME is a list of time points commencing at 0.</p>
</section>
</section>
<section id="creating-a-pyomo-model">
<h2><span class="section-number">4.5.5. </span>Creating a Pyomo model<a class="headerlink" href="#creating-a-pyomo-model" title="Link to this heading">#</a></h2>
<p>The following Pyomo model closely follows the development in Kondili, et al. (1993). In particular, the first step in the model is to process the STN data to create sets as given in Kondili.</p>
<p>One important difference from Kondili is the adoption of a more natural time scale that starts at <span class="math notranslate nohighlight">\(t = 0\)</span> and extends to <span class="math notranslate nohighlight">\(t = H\)</span> (rather than from 1 to H+1).</p>
<p>A second difference is the introduction of an additional decision variable denoted by <span class="math notranslate nohighlight">\(Q_{j,t}\)</span> indicating the amount of material in unit <span class="math notranslate nohighlight">\(j\)</span> at time <span class="math notranslate nohighlight">\(t\)</span>. A material balance then reads</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
Q_{jt} &amp; = Q_{j(t-1)} + \sum_{i\in I_j}B_{ijt} - \sum_{i\in I_j}\sum_{\substack{s \in \bar{S}_i\\s\ni t-P_{is} \geq 0}}\bar{\rho}_{is}B_{ij(t-P_{is})} \qquad \forall j,t
\end{align*}
\end{split}\]</div>
<p>Following Kondili’s notation, <span class="math notranslate nohighlight">\(I_j\)</span> is the set of tasks that can be performed in unit <span class="math notranslate nohighlight">\(j\)</span>, and <span class="math notranslate nohighlight">\(\bar{S}_i\)</span> is the set of states fed by task <span class="math notranslate nohighlight">\(j\)</span>. We assume the units are empty at the beginning and end of production period, i.e.,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
Q_{j(-1)} &amp; = 0 \qquad \forall j \\
Q_{j,H} &amp; = 0 \qquad \forall j
\end{align*}
\end{split}\]</div>
<p>The unit allocation constraints are written the full backward aggregation method described by Shah (1993).  The allocation constraint reads</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
\sum_{i \in I_j} \sum_{t'=t}^{t-p_i+1} W_{ijt'} &amp; \leq 1 \qquad \forall j,t
\end{align*}
\]</div>
<p>Each processing unit <span class="math notranslate nohighlight">\(j\)</span> is tagged with a minimum and maximum capacity, <span class="math notranslate nohighlight">\(B_{ij}^{min}\)</span> and <span class="math notranslate nohighlight">\(B_{ij}^{max}\)</span>, respectively, denoting the minimum and maximum batch sizes for each task <span class="math notranslate nohighlight">\(i\)</span>. A minimum capacity may be needed to cover heat exchange coils in a reactor or mixing blades in a blender, for example. The capacity may depend on the nature of the task being performed.  These constraints are written</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
B_{ij}^{min}W_{ijt} &amp; \leq B_{ijt} \leq  B_{ij}^{max}W_{ijt} \qquad \forall j, \forall i\in I_j, \forall t
\end{align*}
\]</div>
<section id="characterization-of-tasks">
<h3><span class="section-number">4.5.5.1. </span>Characterization of tasks<a class="headerlink" href="#characterization-of-tasks" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">STATES</span> <span class="o">=</span> <span class="n">STN</span><span class="p">[</span><span class="s1">&#39;STATES&#39;</span><span class="p">]</span>
<span class="n">ST_ARCS</span> <span class="o">=</span> <span class="n">STN</span><span class="p">[</span><span class="s1">&#39;ST_ARCS&#39;</span><span class="p">]</span>
<span class="n">TS_ARCS</span> <span class="o">=</span> <span class="n">STN</span><span class="p">[</span><span class="s1">&#39;TS_ARCS&#39;</span><span class="p">]</span>
<span class="n">UNIT_TASKS</span> <span class="o">=</span> <span class="n">STN</span><span class="p">[</span><span class="s1">&#39;UNIT_TASKS&#39;</span><span class="p">]</span>
<span class="n">TIME</span> <span class="o">=</span> <span class="n">STN</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">]</span>
<span class="n">H</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">TIME</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set of tasks</span>
<span class="n">TASKS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">UNIT_TASKS</span><span class="p">])</span>

<span class="c1"># S[i] input set of states which feed task i</span>
<span class="n">S</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">TASKS</span><span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ST_ARCS</span><span class="p">:</span>
    <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># S_[i] output set of states fed by task i</span>
<span class="n">S_</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">TASKS</span><span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="n">TS_ARCS</span><span class="p">:</span>
    <span class="n">S_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># rho[(i,s)] input fraction of task i from state s</span>
<span class="n">rho</span> <span class="o">=</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">):</span> <span class="n">ST_ARCS</span><span class="p">[(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)][</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ST_ARCS</span><span class="p">}</span>

<span class="c1"># rho_[(i,s)] output fraction of task i to state s</span>
<span class="n">rho_</span> <span class="o">=</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">):</span> <span class="n">TS_ARCS</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)][</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="n">TS_ARCS</span><span class="p">}</span>

<span class="c1"># P[(i,s)] time for task i output to state s </span>
<span class="n">P</span> <span class="o">=</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">):</span> <span class="n">TS_ARCS</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)][</span><span class="s1">&#39;dur&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="n">TS_ARCS</span><span class="p">}</span>

<span class="c1"># p[i] completion time for task i</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">max</span><span class="p">([</span><span class="n">P</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S_</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">TASKS</span><span class="p">}</span>

<span class="c1"># K[i] set of units capable of task i</span>
<span class="n">K</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">TASKS</span><span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">UNIT_TASKS</span><span class="p">:</span>
    <span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
</section>
<section id="characterization-of-states">
<h3><span class="section-number">4.5.5.2. </span>Characterization of states<a class="headerlink" href="#characterization-of-states" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># T[s] set of tasks receiving material from state s</span>
<span class="n">T</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ST_ARCS</span><span class="p">:</span>
    <span class="n">T</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="c1"># set of tasks producing material for state s</span>
<span class="n">T_</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="n">TS_ARCS</span><span class="p">:</span>
    <span class="n">T_</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="c1"># C[s] storage capacity for state s</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="n">STATES</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;capacity&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="characterization-of-units">
<h3><span class="section-number">4.5.5.3. </span>Characterization of units<a class="headerlink" href="#characterization-of-units" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">UNITS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">UNIT_TASKS</span><span class="p">])</span>

<span class="c1"># I[j] set of tasks performed with unit j</span>
<span class="n">I</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">UNIT_TASKS</span><span class="p">:</span>
    <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="c1"># Bmax[(i,j)] maximum capacity of unit j for task i</span>
<span class="n">Bmax</span> <span class="o">=</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">):</span><span class="n">UNIT_TASKS</span><span class="p">[(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)][</span><span class="s1">&#39;Bmax&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">UNIT_TASKS</span><span class="p">}</span>

<span class="c1"># Bmin[(i,j)] minimum capacity of unit j for task i</span>
<span class="n">Bmin</span> <span class="o">=</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">):</span><span class="n">UNIT_TASKS</span><span class="p">[(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)][</span><span class="s1">&#39;Bmin&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">UNIT_TASKS</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="pyomo-model">
<h3><span class="section-number">4.5.5.4. </span>Pyomo model<a class="headerlink" href="#pyomo-model" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TIME</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">TIME</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">()</span>

<span class="c1"># W[i,j,t] 1 if task i starts in unit j at time t</span>
<span class="n">model</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">TASKS</span><span class="p">,</span> <span class="n">UNITS</span><span class="p">,</span> <span class="n">TIME</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">Boolean</span><span class="p">)</span>

<span class="c1"># B[i,j,t,] size of batch assigned to task i in unit j at time t</span>
<span class="n">model</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">TASKS</span><span class="p">,</span> <span class="n">UNITS</span><span class="p">,</span> <span class="n">TIME</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>

<span class="c1"># S[s,t] inventory of state s at time t</span>
<span class="n">model</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">TIME</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>

<span class="c1"># Q[j,t] inventory of unit j at time t</span>
<span class="n">model</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">UNITS</span><span class="p">,</span> <span class="n">TIME</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>

<span class="c1"># Objective function</span>

<span class="c1"># project value</span>
<span class="n">model</span><span class="o">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">valuec</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Value</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">([</span><span class="n">STATES</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">H</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="p">]))</span>

<span class="c1"># project cost</span>
<span class="n">model</span><span class="o">.</span><span class="n">Cost</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">costc</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Cost</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">([</span><span class="n">UNIT_TASKS</span><span class="p">[(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)][</span><span class="s1">&#39;Cost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span>
        <span class="n">UNIT_TASKS</span><span class="p">[(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)][</span><span class="s1">&#39;vCost&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">TASKS</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">]))</span> 

<span class="n">model</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Value</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">Cost</span><span class="p">,</span> <span class="n">sense</span> <span class="o">=</span> <span class="n">maximize</span><span class="p">)</span>

<span class="c1"># Constraints</span>
<span class="n">model</span><span class="o">.</span><span class="n">cons</span> <span class="o">=</span> <span class="n">ConstraintList</span><span class="p">()</span>

<span class="c1"># a unit can only be allocated to one task </span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">:</span>
        <span class="n">lhs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">tprime</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tprime</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">UNIT_TASKS</span><span class="p">[(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)][</span><span class="s1">&#39;Tclean&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">tprime</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="p">:</span>
                    <span class="n">lhs</span> <span class="o">+=</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">tprime</span><span class="p">]</span>
        <span class="n">model</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lhs</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
    
<span class="c1"># state capacity constraint</span>
<span class="n">model</span><span class="o">.</span><span class="n">sc</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">TIME</span><span class="p">,</span> <span class="n">rule</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">C</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>

<span class="c1"># state mass balances</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">rhs</span> <span class="o">=</span> <span class="n">STATES</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;initial&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">T_</span><span class="p">[</span><span class="n">s</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="n">P</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]:</span> 
                    <span class="n">rhs</span> <span class="o">+=</span> <span class="n">rho_</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">TIME</span><span class="p">[</span><span class="n">TIME</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="o">-</span><span class="n">P</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]])]</span>             
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">T</span><span class="p">[</span><span class="n">s</span><span class="p">]:</span>
            <span class="n">rhs</span> <span class="o">-=</span> <span class="n">rho</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]</span><span class="o">*</span><span class="nb">sum</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="n">model</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">rhs</span><span class="p">)</span>
        <span class="n">rhs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> 
    
<span class="c1"># unit capacity constraints</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">Bmin</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">])</span>
            <span class="n">model</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">Bmax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> 

<span class="c1"># unit mass balances</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">:</span>
    <span class="n">rhs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">:</span>
        <span class="n">rhs</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S_</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="n">P</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]:</span>
                    <span class="n">rhs</span> <span class="o">-=</span> <span class="n">rho_</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">TIME</span><span class="p">[</span><span class="n">TIME</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="o">-</span><span class="n">P</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]])]</span>
        <span class="n">model</span><span class="o">.</span><span class="n">cons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">rhs</span><span class="p">)</span>
        <span class="n">rhs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]</span>

<span class="c1"># unit terminal condition</span>
<span class="n">model</span><span class="o">.</span><span class="n">tc</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">UNITS</span><span class="p">,</span> <span class="n">rule</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">H</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># ==========================================================
# = Solver Results                                         =
# ==========================================================
# ----------------------------------------------------------
#   Problem Information
# ----------------------------------------------------------
Problem: 
- Name: unknown
  Lower bound: -4870.33333333
  Upper bound: -4870.33333333
  Number of objectives: 1
  Number of constraints: 252
  Number of variables: 332
  Number of binary variables: 136
  Number of integer variables: 136
  Number of nonzeros: 136
  Sense: maximize
# ----------------------------------------------------------
#   Solver Information
# ----------------------------------------------------------
Solver: 
- Status: ok
  User time: -1.0
  System time: 2.22
  Wallclock time: 2.28
  Termination condition: optimal
  Termination message: Model was solved to optimality (subject to tolerances), and an optimal solution is available.
  Statistics: 
    Branch and bound: 
      Number of bounded subproblems: 1476
      Number of created subproblems: 1476
    Black box: 
      Number of iterations: 17777
  Error rc: 0
  Time: 2.296165943145752
# ----------------------------------------------------------
#   Solution Information
# ----------------------------------------------------------
Solution: 
- number of solutions: 0
  number of solutions displayed: 0
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="analysis">
<h2><span class="section-number">4.5.6. </span>Analysis<a class="headerlink" href="#analysis" title="Link to this heading">#</a></h2>
<section id="profitability">
<h3><span class="section-number">4.5.6.1. </span>Profitability<a class="headerlink" href="#profitability" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Value of State Inventories = </span><span class="si">{0:12.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Value</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Cost of Unit Assignments = </span><span class="si">{0:12.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Cost</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;             Net Objective = </span><span class="si">{0:12.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Value</span><span class="p">()</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">Cost</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Value of State Inventories =      4893.33
  Cost of Unit Assignments =        23.00
             Net Objective =      4870.33
</pre></div>
</div>
</div>
</div>
</section>
<section id="unit-assignment">
<h3><span class="section-number">4.5.6.2. </span>Unit assignment<a class="headerlink" href="#unit-assignment" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">UnitAssignment</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">j</span><span class="p">:[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">TIME</span><span class="p">)</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S_</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">t</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">TIME</span><span class="p">[</span><span class="n">TIME</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]])]()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">UnitAssignment</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>               
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">UnitAssignment</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]())</span>

<span class="n">UnitAssignment</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Heater</th>
      <th>Reactor_1</th>
      <th>Reactor_2</th>
      <th>Still</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>None</td>
      <td>(Reaction_1, 80.0)</td>
      <td>(Reaction_1, 80.0)</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(Heating, 100.0)</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>None</td>
      <td>(Reaction_1, 80.0)</td>
      <td>(Reaction_2, 80.0)</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>None</td>
      <td>(Reaction_2, 80.0)</td>
      <td>(Reaction_2, 80.0)</td>
      <td>None</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(Heating, 60.0)</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6</th>
      <td>None</td>
      <td>(Reaction_3, 80.0)</td>
      <td>(Reaction_2, 80.0)</td>
      <td>None</td>
    </tr>
    <tr>
      <th>7</th>
      <td>None</td>
      <td>(Reaction_3, 80.0)</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>8</th>
      <td>None</td>
      <td>(Reaction_3, 80.0)</td>
      <td>(Reaction_2, 80.0)</td>
      <td>(Separation, 160.0)</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(Heating, 53.333333)</td>
      <td>(Reaction_1, 80.0)</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>10</th>
      <td>None</td>
      <td>None</td>
      <td>(Reaction_3, 80.0)</td>
      <td>None</td>
    </tr>
    <tr>
      <th>11</th>
      <td>None</td>
      <td>(Reaction_2, 53.333333)</td>
      <td>(Reaction_2, 80.0)</td>
      <td>(Separation, 160.0)</td>
    </tr>
    <tr>
      <th>12</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>13</th>
      <td>None</td>
      <td>(Reaction_3, 40.0)</td>
      <td>(Reaction_3, 80.0)</td>
      <td>None</td>
    </tr>
    <tr>
      <th>14</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>(Separation, 120.0)</td>
    </tr>
    <tr>
      <th>15</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>16</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="state-inventories">
<h3><span class="section-number">4.5.6.3. </span>State inventories<a class="headerlink" href="#state-inventories" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">model</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">TIME</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Feed_A</th>
      <th>Feed_B</th>
      <th>Feed_C</th>
      <th>Hot_A</th>
      <th>Int_AB</th>
      <th>Int_BC</th>
      <th>Impure_E</th>
      <th>Product_1</th>
      <th>Product_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>500.00000</td>
      <td>420.0</td>
      <td>420.0</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>400.00000</td>
      <td>420.0</td>
      <td>420.0</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>400.00000</td>
      <td>380.0</td>
      <td>380.0</td>
      <td>68.000000</td>
      <td>0.000000e+00</td>
      <td>112.0</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>400.00000</td>
      <td>380.0</td>
      <td>380.0</td>
      <td>68.000000</td>
      <td>0.000000e+00</td>
      <td>112.0</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>400.00000</td>
      <td>380.0</td>
      <td>380.0</td>
      <td>4.000000</td>
      <td>4.800000e+01</td>
      <td>96.0</td>
      <td>0.0</td>
      <td>32.00000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>340.00000</td>
      <td>380.0</td>
      <td>380.0</td>
      <td>4.000000</td>
      <td>4.800000e+01</td>
      <td>96.0</td>
      <td>0.0</td>
      <td>32.00000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>340.00000</td>
      <td>380.0</td>
      <td>364.0</td>
      <td>32.000000</td>
      <td>8.000000e+01</td>
      <td>48.0</td>
      <td>0.0</td>
      <td>96.00000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>340.00000</td>
      <td>380.0</td>
      <td>348.0</td>
      <td>32.000000</td>
      <td>1.600000e+01</td>
      <td>48.0</td>
      <td>80.0</td>
      <td>96.00000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>340.00000</td>
      <td>380.0</td>
      <td>332.0</td>
      <td>0.000000</td>
      <td>3.182357e-14</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>128.00000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>286.66667</td>
      <td>340.0</td>
      <td>292.0</td>
      <td>0.000000</td>
      <td>6.364715e-14</td>
      <td>0.0</td>
      <td>80.0</td>
      <td>128.00000</td>
      <td>144.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>286.66667</td>
      <td>340.0</td>
      <td>276.0</td>
      <td>53.333333</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>80.0</td>
      <td>160.00000</td>
      <td>144.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>286.66667</td>
      <td>340.0</td>
      <td>276.0</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>160.00000</td>
      <td>144.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>286.66667</td>
      <td>340.0</td>
      <td>276.0</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>160.00000</td>
      <td>288.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>286.66667</td>
      <td>340.0</td>
      <td>252.0</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>213.33333</td>
      <td>288.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>286.66667</td>
      <td>340.0</td>
      <td>252.0</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>213.33333</td>
      <td>288.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>286.66667</td>
      <td>340.0</td>
      <td>252.0</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>213.33333</td>
      <td>396.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>286.66667</td>
      <td>340.0</td>
      <td>252.0</td>
      <td>0.000000</td>
      <td>1.200000e+01</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>213.33333</td>
      <td>396.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">()))):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span><span class="mi">3</span><span class="p">,</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tlast</span><span class="p">,</span><span class="n">ylast</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">STATES</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;initial&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">TIME</span><span class="p">),[</span><span class="n">model</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">]):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">tlast</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">],[</span><span class="n">ylast</span><span class="p">,</span><span class="n">ylast</span><span class="p">,</span><span class="n">y</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="c1">#plt.plot([tlast,t],[ylast,y],&#39;b.&#39;,ms=10)</span>
        <span class="n">tlast</span><span class="p">,</span><span class="n">ylast</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span><span class="n">y</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.1</span><span class="o">*</span><span class="n">C</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">H</span><span class="p">],[</span><span class="n">C</span><span class="p">[</span><span class="n">s</span><span class="p">],</span><span class="n">C</span><span class="p">[</span><span class="n">s</span><span class="p">]],</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8e665fcc1a79c4febef2d9380428bd508d9d66237cdbee6c6e4b3b0ae3c10efb.png" src="../_images/8e665fcc1a79c4febef2d9380428bd508d9d66237cdbee6c6e4b3b0ae3c10efb.png" />
</div>
</div>
</section>
<section id="unit-batch-inventories">
<h3><span class="section-number">4.5.6.4. </span>Unit batch inventories<a class="headerlink" href="#unit-batch-inventories" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">model</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">UNITS</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">TIME</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Heater</th>
      <th>Reactor_1</th>
      <th>Reactor_2</th>
      <th>Still</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.000000</td>
      <td>80.000000</td>
      <td>80.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>100.000000</td>
      <td>80.000000</td>
      <td>80.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.000000</td>
      <td>80.000000</td>
      <td>80.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.000000</td>
      <td>80.000000</td>
      <td>80.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.000000</td>
      <td>80.000000</td>
      <td>80.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>60.000000</td>
      <td>80.000000</td>
      <td>80.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.000000</td>
      <td>80.000000</td>
      <td>80.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.000000</td>
      <td>80.000000</td>
      <td>80.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.000000</td>
      <td>80.000000</td>
      <td>80.0</td>
      <td>160.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>53.333333</td>
      <td>80.000000</td>
      <td>80.0</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.000000</td>
      <td>80.000000</td>
      <td>80.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.000000</td>
      <td>53.333333</td>
      <td>80.0</td>
      <td>160.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.000000</td>
      <td>53.333333</td>
      <td>80.0</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.000000</td>
      <td>40.000000</td>
      <td>80.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>120.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="gannt-chart">
<h3><span class="section-number">4.5.6.5. </span>Gannt chart<a class="headerlink" href="#gannt-chart" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">gap</span> <span class="o">=</span> <span class="n">H</span><span class="o">/</span><span class="mi">500</span>
<span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">lbls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ticks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">UNITS</span><span class="p">):</span>
    <span class="n">idx</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
        <span class="n">idx</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">ticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">lbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2"> -&gt; </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">H</span><span class="p">],[</span><span class="n">idx</span><span class="p">,</span><span class="n">idx</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="o">+</span><span class="n">gap</span><span class="p">,</span><span class="n">t</span><span class="o">+</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">gap</span><span class="p">],</span> <span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">idx</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;butt&#39;</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]())</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">H</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">lbls</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/96873eae5d88f2ed43e341dcab45cb6a6385d5e282364b68468e77d38d88d008.png" src="../_images/96873eae5d88f2ed43e341dcab45cb6a6385d5e282364b68468e77d38d88d008.png" />
</div>
</div>
</section>
</section>
<section id="trace-of-events-and-states">
<h2><span class="section-number">4.5.7. </span>Trace of events and states<a class="headerlink" href="#trace-of-events-and-states" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">--------------------------------------------------------------------------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting Conditions&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Initial Inventories:&quot;</span><span class="p">)</span>            
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        </span><span class="si">{0:10s}</span><span class="s2">  </span><span class="si">{1:6.1f}</span><span class="s2"> kg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">STATES</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;initial&#39;</span><span class="p">]))</span>
        
<span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:{</span><span class="s1">&#39;assignment&#39;</span><span class="p">:</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">}</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time =&quot;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="s2">&quot;hr&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Instructions:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">:</span>
        <span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># transfer from unit to states</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>  
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S_</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">t</span><span class="o">-</span><span class="n">P</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">amt</span> <span class="o">=</span> <span class="n">rho_</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">TIME</span><span class="p">[</span><span class="n">TIME</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">P</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]])]()</span>
                    <span class="k">if</span> <span class="n">amt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        Transfer&quot;</span><span class="p">,</span> <span class="n">amt</span><span class="p">,</span> <span class="s2">&quot;kg from&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">:</span>
        <span class="c1"># release units from tasks</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">TIME</span><span class="p">[</span><span class="n">TIME</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]])]()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        Release&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="s2">&quot;from&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                    <span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;assignment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>
                    <span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># assign units to tasks             </span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        Assign&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="s2">&quot;with capacity&quot;</span><span class="p">,</span> <span class="n">Bmax</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)],</span> <span class="s2">&quot;kg to task&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s2">&quot;for&quot;</span><span class="p">,</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s2">&quot;hours&quot;</span><span class="p">)</span>
                <span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;assignment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># transfer from states to starting tasks</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">amt</span> <span class="o">=</span> <span class="n">rho</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span>
                <span class="k">if</span> <span class="n">amt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        Transfer&quot;</span><span class="p">,</span> <span class="n">amt</span><span class="p">,</span><span class="s2">&quot;kg from&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    Inventories are now:&quot;</span><span class="p">)</span>            
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        </span><span class="si">{0:10s}</span><span class="s2">  </span><span class="si">{1:6.1f}</span><span class="s2"> kg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    Unit Assignments are now:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;assignment&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;        </span><span class="si">{0:s}</span><span class="s2"> performs the </span><span class="si">{1:s}</span><span class="s2"> task with a </span><span class="si">{2:.2f}</span><span class="s2"> kg batch for hour </span><span class="si">{3:f}</span><span class="s2"> of </span><span class="si">{4:f}</span><span class="s2">&quot;</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;assignment&#39;</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">](),</span><span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            
<span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Final Conditions&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Final Inventories:&quot;</span><span class="p">)</span>            
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        </span><span class="si">{0:10s}</span><span class="s2">  </span><span class="si">{1:6.1f}</span><span class="s2"> kg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">H</span><span class="p">]()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--------------------------------------------------------------------------------------------

Starting Conditions
    Initial Inventories:
        Feed_A       500.0 kg
        Feed_B       500.0 kg
        Feed_C       500.0 kg
        Hot_A          0.0 kg
        Int_AB         0.0 kg
        Int_BC         0.0 kg
        Impure_E       0.0 kg
        Product_1      0.0 kg
        Product_2      0.0 kg

--------------------------------------------------------------------------------------------

Time = 0 hr
    Instructions:
        Assign Reactor_2 with capacity 80 kg to task Reaction_1 for 2 hours
        Transfer 40.0 kg from Feed_C to Reactor_2
        Transfer 40.0 kg from Feed_B to Reactor_2
        Assign Reactor_1 with capacity 80 kg to task Reaction_1 for 2 hours
        Transfer 40.0 kg from Feed_C to Reactor_1
        Transfer 40.0 kg from Feed_B to Reactor_1
        Assign Heater with capacity 100 kg to task Heating for 1 hours
        Transfer 6.6666667 kg from Feed_A to Heater

    Inventories are now:
        Feed_A       493.3 kg
        Feed_B       420.0 kg
        Feed_C       420.0 kg
        Hot_A          0.0 kg
        Int_AB         0.0 kg
        Int_BC         0.0 kg
        Impure_E       0.0 kg
        Product_1      0.0 kg
        Product_2      0.0 kg

    Unit Assignments are now:
        Reactor_2 performs the Reaction_1 task with a 80.00 kg batch for hour 1.000000 of 2.000000
        Reactor_1 performs the Reaction_1 task with a 80.00 kg batch for hour 1.000000 of 2.000000
        Heater performs the Heating task with a 6.67 kg batch for hour 1.000000 of 1.000000

--------------------------------------------------------------------------------------------

Time = 1 hr
    Instructions:
        Transfer 6.6666667 kg from Heater to Hot_A
        Release Heater from Heating
        Assign Heater with capacity 100 kg to task Heating for 1 hours
        Transfer 100.0 kg from Feed_A to Heater

    Inventories are now:
        Feed_A       393.3 kg
        Feed_B       420.0 kg
        Feed_C       420.0 kg
        Hot_A          6.7 kg
        Int_AB         0.0 kg
        Int_BC         0.0 kg
        Impure_E       0.0 kg
        Product_1      0.0 kg
        Product_2      0.0 kg

    Unit Assignments are now:
        Reactor_2 performs the Reaction_1 task with a 80.00 kg batch for hour 2.000000 of 2.000000
        Reactor_1 performs the Reaction_1 task with a 80.00 kg batch for hour 2.000000 of 2.000000
        Heater performs the Heating task with a 100.00 kg batch for hour 1.000000 of 1.000000

--------------------------------------------------------------------------------------------

Time = 2 hr
    Instructions:
        Transfer 80.0 kg from Reactor_2 to Int_BC
        Transfer 80.0 kg from Reactor_1 to Int_BC
        Transfer 100.0 kg from Heater to Hot_A
        Release Reactor_2 from Reaction_1
        Assign Reactor_2 with capacity 80 kg to task Reaction_2 for 2 hours
        Transfer 48.0 kg from Int_BC to Reactor_2
        Transfer 32.0 kg from Hot_A to Reactor_2
        Release Reactor_1 from Reaction_1
        Assign Reactor_1 with capacity 80 kg to task Reaction_2 for 2 hours
        Transfer 48.0 kg from Int_BC to Reactor_1
        Transfer 32.0 kg from Hot_A to Reactor_1
        Release Heater from Heating

    Inventories are now:
        Feed_A       393.3 kg
        Feed_B       420.0 kg
        Feed_C       420.0 kg
        Hot_A         42.7 kg
        Int_AB         0.0 kg
        Int_BC        64.0 kg
        Impure_E       0.0 kg
        Product_1      0.0 kg
        Product_2      0.0 kg

    Unit Assignments are now:
        Reactor_2 performs the Reaction_2 task with a 80.00 kg batch for hour 1.000000 of 2.000000
        Reactor_1 performs the Reaction_2 task with a 80.00 kg batch for hour 1.000000 of 2.000000

--------------------------------------------------------------------------------------------

Time = 3 hr
    Instructions:

    Inventories are now:
        Feed_A       393.3 kg
        Feed_B       420.0 kg
        Feed_C       420.0 kg
        Hot_A         42.7 kg
        Int_AB         0.0 kg
        Int_BC        64.0 kg
        Impure_E       0.0 kg
        Product_1      0.0 kg
        Product_2      0.0 kg

    Unit Assignments are now:
        Reactor_2 performs the Reaction_2 task with a 80.00 kg batch for hour 2.000000 of 2.000000
        Reactor_1 performs the Reaction_2 task with a 80.00 kg batch for hour 2.000000 of 2.000000

--------------------------------------------------------------------------------------------

Time = 4 hr
    Instructions:
        Transfer 48.0 kg from Reactor_2 to Int_AB
        Transfer 32.0 kg from Reactor_2 to Product_1
        Transfer 48.0 kg from Reactor_1 to Int_AB
        Transfer 32.0 kg from Reactor_1 to Product_1
        Release Reactor_2 from Reaction_2
        Assign Reactor_2 with capacity 80 kg to task Reaction_3 for 1 hours
        Transfer 32.0 kg from Int_AB to Reactor_2
        Transfer 8.0 kg from Feed_C to Reactor_2
        Release Reactor_1 from Reaction_2
        Assign Reactor_1 with capacity 80 kg to task Reaction_3 for 1 hours
        Transfer 64.0 kg from Int_AB to Reactor_1
        Transfer 16.0 kg from Feed_C to Reactor_1

    Inventories are now:
        Feed_A       393.3 kg
        Feed_B       420.0 kg
        Feed_C       396.0 kg
        Hot_A         42.7 kg
        Int_AB         0.0 kg
        Int_BC        64.0 kg
        Impure_E       0.0 kg
        Product_1     64.0 kg
        Product_2      0.0 kg

    Unit Assignments are now:
        Reactor_2 performs the Reaction_3 task with a 40.00 kg batch for hour 1.000000 of 1.000000
        Reactor_1 performs the Reaction_3 task with a 80.00 kg batch for hour 1.000000 of 1.000000

--------------------------------------------------------------------------------------------

Time = 5 hr
    Instructions:
        Transfer 40.0 kg from Reactor_2 to Impure_E
        Transfer 80.0 kg from Reactor_1 to Impure_E
        Release Reactor_2 from Reaction_3
        Assign Reactor_2 with capacity 80 kg to task Reaction_2 for 2 hours
        Transfer 48.0 kg from Int_BC to Reactor_2
        Transfer 32.0 kg from Hot_A to Reactor_2
        Assign Still with capacity 200 kg to task Separation for 2 hours
        Transfer 120.0 kg from Impure_E to Still
        Release Reactor_1 from Reaction_3
        Assign Reactor_1 with capacity 80 kg to task Reaction_2 for 2 hours
        Transfer 16.0000002 kg from Int_BC to Reactor_1
        Transfer 10.666666800000002 kg from Hot_A to Reactor_1

    Inventories are now:
        Feed_A       393.3 kg
        Feed_B       420.0 kg
        Feed_C       396.0 kg
        Hot_A          0.0 kg
        Int_AB         0.0 kg
        Int_BC         0.0 kg
        Impure_E       0.0 kg
        Product_1     64.0 kg
        Product_2      0.0 kg

    Unit Assignments are now:
        Reactor_2 performs the Reaction_2 task with a 80.00 kg batch for hour 1.000000 of 2.000000
        Still performs the Separation task with a 120.00 kg batch for hour 1.000000 of 2.000000
        Reactor_1 performs the Reaction_2 task with a 26.67 kg batch for hour 1.000000 of 2.000000

--------------------------------------------------------------------------------------------

Time = 6 hr
    Instructions:
        Transfer 108.0 kg from Still to Product_2

    Inventories are now:
        Feed_A       393.3 kg
        Feed_B       420.0 kg
        Feed_C       396.0 kg
        Hot_A          0.0 kg
        Int_AB         0.0 kg
        Int_BC         0.0 kg
        Impure_E       0.0 kg
        Product_1     64.0 kg
        Product_2    108.0 kg

    Unit Assignments are now:
        Reactor_2 performs the Reaction_2 task with a 80.00 kg batch for hour 2.000000 of 2.000000
        Still performs the Separation task with a 12.00 kg batch for hour 2.000000 of 2.000000
        Reactor_1 performs the Reaction_2 task with a 26.67 kg batch for hour 2.000000 of 2.000000

--------------------------------------------------------------------------------------------

Time = 7 hr
    Instructions:
        Transfer 48.0 kg from Reactor_2 to Int_AB
        Transfer 32.0 kg from Reactor_2 to Product_1
        Transfer 12.0 kg from Still to Int_AB
        Transfer 16.0000002 kg from Reactor_1 to Int_AB
        Transfer 10.666666800000002 kg from Reactor_1 to Product_1
        Release Reactor_2 from Reaction_2
        Assign Reactor_2 with capacity 80 kg to task Reaction_3 for 1 hours
        Transfer 64.0 kg from Int_AB to Reactor_2
        Transfer 16.0 kg from Feed_C to Reactor_2
        Release Still from Separation
        Release Reactor_1 from Reaction_2
        Assign Reactor_1 with capacity 80 kg to task Reaction_3 for 1 hours
        Transfer 12.0 kg from Int_AB to Reactor_1
        Transfer 3.0 kg from Feed_C to Reactor_1

    Inventories are now:
        Feed_A       393.3 kg
        Feed_B       420.0 kg
        Feed_C       377.0 kg
        Hot_A          0.0 kg
        Int_AB         0.0 kg
        Int_BC         0.0 kg
        Impure_E       0.0 kg
        Product_1    106.7 kg
        Product_2    108.0 kg

    Unit Assignments are now:
        Reactor_2 performs the Reaction_3 task with a 80.00 kg batch for hour 1.000000 of 1.000000
        Reactor_1 performs the Reaction_3 task with a 15.00 kg batch for hour 1.000000 of 1.000000

--------------------------------------------------------------------------------------------

Time = 8 hr
    Instructions:
        Transfer 80.0 kg from Reactor_2 to Impure_E
        Transfer 15.0 kg from Reactor_1 to Impure_E
        Release Reactor_2 from Reaction_3
        Assign Still with capacity 200 kg to task Separation for 2 hours
        Transfer 95.0 kg from Impure_E to Still
        Release Reactor_1 from Reaction_3

    Inventories are now:
        Feed_A       393.3 kg
        Feed_B       420.0 kg
        Feed_C       377.0 kg
        Hot_A          0.0 kg
        Int_AB         0.0 kg
        Int_BC         0.0 kg
        Impure_E       0.0 kg
        Product_1    106.7 kg
        Product_2    108.0 kg

    Unit Assignments are now:
        Still performs the Separation task with a 95.00 kg batch for hour 1.000000 of 2.000000

--------------------------------------------------------------------------------------------

Time = 9 hr
    Instructions:
        Transfer 85.5 kg from Still to Product_2

    Inventories are now:
        Feed_A       393.3 kg
        Feed_B       420.0 kg
        Feed_C       377.0 kg
        Hot_A          0.0 kg
        Int_AB         0.0 kg
        Int_BC         0.0 kg
        Impure_E       0.0 kg
        Product_1    106.7 kg
        Product_2    193.5 kg

    Unit Assignments are now:
        Still performs the Separation task with a 9.50 kg batch for hour 2.000000 of 2.000000

--------------------------------------------------------------------------------------------

Time = 10 hr
    Instructions:
        Transfer 9.5 kg from Still to Int_AB
        Release Still from Separation

    Inventories are now:
        Feed_A       393.3 kg
        Feed_B       420.0 kg
        Feed_C       377.0 kg
        Hot_A          0.0 kg
        Int_AB         9.5 kg
        Int_BC         0.0 kg
        Impure_E       0.0 kg
        Product_1    106.7 kg
        Product_2    193.5 kg

    Unit Assignments are now:

--------------------------------------------------------------------------------------------

Final Conditions
    Final Inventories:
        Feed_A       393.3 kg
        Feed_B       420.0 kg
        Feed_C       377.0 kg
        Hot_A          0.0 kg
        Int_AB         9.5 kg
        Int_BC         0.0 kg
        Impure_E       0.0 kg
        Product_1    106.7 kg
        Product_2    193.5 kg
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="04.04-Maintenance-Planning.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">4.4. </span>Maintenance Planning</p>
      </div>
    </a>
    <a class="right-next"
       href="04.06-Unit-Commitment.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">4.6. </span>Unit Commitment</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">4.5.1. Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">4.5.2. References</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-kondili-et-al-1993">4.5.3. Example (Kondili, et al., 1993)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">4.5.3.1. Exercise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#encoding-the-stn-data">4.5.4. Encoding the STN data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-a-time-grid">4.5.4.1. Setting a time grid</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-pyomo-model">4.5.5. Creating a Pyomo model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#characterization-of-tasks">4.5.5.1. Characterization of tasks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#characterization-of-states">4.5.5.2. Characterization of states</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#characterization-of-units">4.5.5.3. Characterization of units</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pyomo-model">4.5.5.4. Pyomo model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis">4.5.6. Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#profitability">4.5.6.1. Profitability</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unit-assignment">4.5.6.2. Unit assignment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#state-inventories">4.5.6.3. State inventories</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unit-batch-inventories">4.5.6.4. Unit batch inventories</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gannt-chart">4.5.6.5. Gannt chart</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#trace-of-events-and-states">4.5.7. Trace of events and states</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jeffrey C. Kantor
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>