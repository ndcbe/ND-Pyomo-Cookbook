
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>7.1. Parameter estimation &#8212; ND Pyomo Cookbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/07.01-Parameter-Estimation-Catalytic-Reactor';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8. Financial Applications" href="08.00-Financial-Applications.html" />
    <link rel="prev" title="7. Parameter Estimation" href="07.00-Parameter-Estimation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/Kondili_1993.png" class="logo__image only-light" alt="ND Pyomo Cookbook - Home"/>
    <img src="../_static/Kondili_1993.png" class="logo__image only-dark pst-js-only" alt="ND Pyomo Cookbook - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    ND Pyomo Cookbook
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="01.00-Getting-Started-with-Pyomo.html">1. Getting Started with Pyomo</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="01.01-Installing-Pyomo.html">1.1. Installing a Pyomo/Python Development Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="01.02-Running-Pyomo-on-Google-Colab.html">1.2. Running Pyomo on Google Colab</a></li>
<li class="toctree-l2"><a class="reference internal" href="01.03-Running-Pyomo-on-the-Notre-Dame-CRC-Cluster.html">1.3. Running Pyomo on the Notre Dame CRC Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="01.04-Cross-Platform-Installation-of-Pyomo-and-Solvers.html">1.4. Cross-Platform Installation of Pyomo and Solvers</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="02.00-Linear-Programming.html">2. Linear Programming</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="02.01-Production-Models-with-Linear-Constraints.html">2.1. Production Models with Linear Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.02-Production-Model-Sensitivity-Analysis.html">2.2. Production Model Sensitivity Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.03-Linear-Blending-Problem.html">2.3. Linear Blending Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.04-Mixture-Design-Cold-Weather-Fuel.html">2.4. Design of a Cold Weather Fuel for a Camping Stove</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.05-Gasoline-Blending.html">2.5. Gasoline Blending</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.06-Model-Predictive-Control-of-a-Double-Integrator.html">2.6. Model Predictive Control of a Double Integrator</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.07-Non-Continuous-Objective.html">2.7. Non-Continuous Objectives</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="03.00-Assignment-Problems.html">3. Assignment Problems</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="03.01-Transportation-Networks.html">3.1. Transportation Networks</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="04.00-Scheduling-with-Disjunctive-Constraints.html">4. Scheduling with Disjunctive Constraints</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="04.01-Introduction_to_Disjunctive_Programming.html">4.1. Introduction to Disjunctive Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.02-Machine-Bottleneck.html">4.2. Machine Bottleneck</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.03-Job-Shop-Scheduling.html">4.3. Job Shop Scheduling</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.04-Maintenance-Planning.html">4.4. Maintenance Planning</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.05-Scheduling-Multipurpose-Batch-Processes-using-State-Task_Networks.html">4.5. Scheduling Multipurpose Batch Processes using State-Task Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.06-Unit-Commitment.html">4.6. Unit Commitment</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="05.00-Simulation.html">5. Simulation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="05.01-Response-of-a-First-Order-System-to-Step-and-Square-Wave-Inputs.html">5.1. Response of a First Order System to Step and Square Wave Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="05.02-Exothermic-CSTR.html">5.2. Exothermic CSTR</a></li>
<li class="toctree-l2"><a class="reference internal" href="05.03-Heat_Conduction_in_Various_Geometries.html">5.3. Transient Heat Conduction in Various Geometries</a></li>
<li class="toctree-l2"><a class="reference internal" href="05.04-Diffusion_Adsorption_in_Polymers.html">5.4. Diffusion with Adsorption in Polymers</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="06.00-Differential-Algebraic-Equations.html">6. Differential-Algebraic Equations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="06.01-Unconstrained-Scalar-Optimization.html">6.1. Unconstrained Scalar Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="06.02-Maximizing-Concentration-of-an-Intermediate-in-a-Batch-Reactor.html">6.2. Maximizing Concentration of an Intermediate in a Batch Reactor</a></li>
<li class="toctree-l2"><a class="reference internal" href="06.03-Path-Planning-for-a-Simple-Car.html">6.3. Path Planning for a Simple Car</a></li>
<li class="toctree-l2"><a class="reference internal" href="06.04-Soft-Landing-Apollo-11-on-the-Moon.html">6.4. Soft Landing Apollo 11 on the Moon</a></li>
<li class="toctree-l2"><a class="reference internal" href="06.05-Launching-Apollo-11-from-the-Moon.html">6.5. Ascent from Lunar Surface</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="07.00-Parameter-Estimation.html">7. Parameter Estimation</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">7.1. Parameter estimation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="08.00-Financial-Applications.html">8. Financial Applications</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="08.01-Obtaining-Historical-Stock_-ata.html">8.1. Obtaining Historical Stock Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="08.02-Consolidating-and-Charting-Stock-Data.html">8.2. Consolidating and Charting Stock Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="08.03-Binomial-Model-for-Pricing-Options.html">8.3. Binomial Model for Pricing Options</a></li>

<li class="toctree-l2"><a class="reference internal" href="08.04-MAD-Portfolio-Optimization.html">8.5. MAD Portfolio Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="08.05-Real-Options.html">8.6. Real Options</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="09.00-pyomo-coding-guide.html">9. Guide to Coding with Pyomo</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="09.01-notebook-style-guide.html">9.1. Notebook Style Guide</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/ndcbe/ND-Pyomo-Cookbook/blob/main/notebooks/07.01-Parameter-Estimation-Catalytic-Reactor.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ndcbe/ND-Pyomo-Cookbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ndcbe/ND-Pyomo-Cookbook/issues/new?title=Issue%20on%20page%20%2Fnotebooks/07.01-Parameter-Estimation-Catalytic-Reactor.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/07.01-Parameter-Estimation-Catalytic-Reactor.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Parameter estimation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">7.1.1. Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#steps-in-model-fitting">7.1.2. Steps in model fitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-the-data">7.1.3. Step 1. The data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-select-a-model">7.1.4. Step 2. Select a model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-define-a-figure-of-merit">7.1.5. Step 3. Define a “figure of merit”</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-find-a-best-fit">7.1.6. Step 4. Find a best fit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-evaluate-the-goodness-of-fit">7.1.7. Step 5. Evaluate the goodness of fit</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-residuals">7.1.7.1. Plotting residuals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#separable-model">7.1.7.2. Separable model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-6-estimate-confidence-intervals">7.1.8. Step 6. Estimate confidence intervals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-7-determine-if-a-better-fit-is-possible">7.1.9. Step 7. Determine if a better fit is possible</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pyomo-model-version-1">7.1.9.1. Pyomo model - version 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pyomo-model-version-2">7.1.9.2. Pyomo model - version 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pyomo-model-version-3">7.1.9.3. Pyomo model - version 3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#f-ratio-test">7.1.9.4. F-ratio test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#levene-test">7.1.9.5. Levene test</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="parameter-estimation">
<h1><span class="section-number">7.1. </span>Parameter estimation<a class="headerlink" href="#parameter-estimation" title="Link to this heading">#</a></h1>
<p>Keywords: parameter estimation, ipopt usage, data fitting</p>
<p>This notebook demonstrates parameter estimation for the catalytic oxidation experiment conducted in the senior Chemical Engineering Laboratory course at Notre Dame. The reaction can be modeled as</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
\cal{A} \longrightarrow \rm{Products}
\end{align*}
\]</div>
<p>where concentration of <span class="math notranslate nohighlight">\(\cal{A}\)</span> is measured in the reactor feed and effluent streams. This reactor, with high internal recycle, operates in the stirred tank reactor regime.</p>
<section id="imports">
<h2><span class="section-number">7.1.1. </span>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">optimize</span>

<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os.path</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;pyomo&quot;</span><span class="p">):</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>-q<span class="w"> </span>pyomo
    <span class="k">assert</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;pyomo&quot;</span><span class="p">))</span>

<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;ipopt&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;ipopt&quot;</span><span class="p">)):</span>
    <span class="k">if</span> <span class="s2">&quot;google.colab&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
        <span class="o">!</span>wget<span class="w"> </span>-N<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;https://ampl.com/dl/open/ipopt/ipopt-linux64.zip&quot;</span>
        <span class="o">!</span>unzip<span class="w"> </span>-o<span class="w"> </span>-q<span class="w"> </span>ipopt-linux64
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="o">!</span>conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>ipopt<span class="w"> </span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="k">assert</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;ipopt&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;ipopt&quot;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="steps-in-model-fitting">
<h2><span class="section-number">7.1.2. </span>Steps in model fitting<a class="headerlink" href="#steps-in-model-fitting" title="Link to this heading">#</a></h2>
<p>The goal of parameter estimation is to use experimental data to estimate values of the unknown parameters in model describing the system of interest, and to quantify uncertainty associated with those estimates.</p>
<p>Following the outline in <a class="reference external" href="http://clip.med.yale.edu/courses/brdu/Costa_ODE.pdf">“Model Fitting and Error Estimation”, Costa, Kleinstein, Hershberg</a>:</p>
<ol class="arabic simple">
<li><p>Assemble the data in useful data structures. Plot the data. Be sure there is meaningful variations to enable parameter estimation.</p></li>
<li><p>Select an appropriate model based on underlying theory. Identify the known and unknown parameters.</p></li>
<li><p>Define a “figure of merit” function the measures the agreement of model to data for given value of the unknown parameters.</p></li>
<li><p>Adjust the unknown parameters to find the best fit. Generally this involves minimizing the figure of merit function.</p></li>
<li><p>Evaluate the “Goodness of Fit”. Test assumptions of randomness, and for systematic deviations between the model and data.</p></li>
<li><p>Estimate the accuracy of the best-fit parameters. Provide confidence intervals and covariance among unknown parameters.</p></li>
<li><p>Determine whether a better fit is possible.</p></li>
</ol>
<p>This notebook uses the Pandas package to encapsulate and display experimental data. <a class="reference external" href="https://pandas.pydata.org/">Pandas</a> is a comprehensive Python package for managing and displaying data. It provides many useful and time-saving tools for performing common operations on data.</p>
</section>
<section id="step-1-the-data">
<h2><span class="section-number">7.1.3. </span>Step 1. The data<a class="headerlink" href="#step-1-the-data" title="Link to this heading">#</a></h2>
<p>The following data is taken from [“Lecture Notes for CBE 20258” by Prof. David Leighton]. The data consists of measurements done for three different feed concentrations <code class="docutils literal notranslate"><span class="pre">C0</span></code>. For each feed concentration, students adjust reactor temperature <code class="docutils literal notranslate"><span class="pre">T</span></code> using an external heat source, then measure the reactor exit concentration <code class="docutils literal notranslate"><span class="pre">C</span></code>.</p>
<p>For convenience, the data is first encoded as a nested Python dictionary. The first index refers to the name of the experiment. The data for each experiment is then encoded as a nested dictionary with name, value pairs. The values are strings, numbers, or lists of measured responses. The name of the experiment is repeated to facilitate conversion to a Pandas data frame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Expt A&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Expt&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span>
        <span class="s1">&#39;C0&#39;</span>  <span class="p">:</span> <span class="mf">1.64E-4</span><span class="p">,</span>
        <span class="s1">&#39;T&#39;</span>   <span class="p">:</span> <span class="p">[</span><span class="mi">423</span><span class="p">,</span> <span class="mi">449</span><span class="p">,</span> <span class="mi">471</span><span class="p">,</span> <span class="mi">495</span><span class="p">,</span> <span class="mi">518</span><span class="p">,</span> <span class="mi">534</span><span class="p">,</span> <span class="mi">549</span><span class="p">,</span> <span class="mi">563</span><span class="p">],</span>
        <span class="s1">&#39;C&#39;</span>   <span class="p">:</span> <span class="p">[</span><span class="mf">1.66e-4</span><span class="p">,</span> <span class="mf">1.66e-4</span><span class="p">,</span> <span class="mf">1.59e-4</span><span class="p">,</span> <span class="mf">1.37e-4</span><span class="p">,</span> <span class="mf">8.90e-5</span><span class="p">,</span> <span class="mf">5.63e-5</span><span class="p">,</span> <span class="mf">3.04e-5</span><span class="p">,</span> <span class="mf">1.71e-5</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="s1">&#39;Expt B&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Expt&#39;</span><span class="p">:</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span>
        <span class="s1">&#39;C0&#39;</span>  <span class="p">:</span> <span class="mf">3.69e-4</span> <span class="p">,</span>
        <span class="s1">&#39;T&#39;</span>   <span class="p">:</span> <span class="p">[</span><span class="mi">423</span><span class="p">,</span> <span class="mi">446</span><span class="p">,</span> <span class="mi">469</span><span class="p">,</span> <span class="mi">490</span><span class="p">,</span> <span class="mi">507</span><span class="p">,</span> <span class="mi">523</span><span class="p">,</span> <span class="mi">539</span><span class="p">,</span> <span class="mi">553</span><span class="p">,</span> <span class="mi">575</span><span class="p">],</span>
        <span class="s1">&#39;C&#39;</span>   <span class="p">:</span> <span class="p">[</span><span class="mf">3.73e-4</span><span class="p">,</span> <span class="mf">3.72e-4</span><span class="p">,</span> <span class="mf">3.59e-4</span><span class="p">,</span> <span class="mf">3.26e-4</span><span class="p">,</span> <span class="mf">2.79e-4</span><span class="p">,</span> <span class="mf">2.06e-4</span><span class="p">,</span> <span class="mf">1.27e-4</span><span class="p">,</span> <span class="mf">7.56e-5</span><span class="p">,</span> <span class="mf">3.76e-5</span><span class="p">],</span>     
    <span class="p">},</span>
    <span class="s1">&#39;Expt C&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Expt&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
        <span class="s1">&#39;C0&#39;</span>  <span class="p">:</span> <span class="mf">2.87e-4</span><span class="p">,</span>
        <span class="s1">&#39;T&#39;</span>   <span class="p">:</span> <span class="p">[</span><span class="mi">443</span><span class="p">,</span> <span class="mi">454</span><span class="p">,</span> <span class="mi">463</span><span class="p">,</span> <span class="mi">475</span><span class="p">,</span> <span class="mi">485</span><span class="p">,</span> <span class="mi">497</span><span class="p">,</span> <span class="mi">509</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span> <span class="mi">534</span><span class="p">,</span> <span class="mi">545</span><span class="p">,</span> <span class="mi">555</span><span class="p">,</span> <span class="mi">568</span><span class="p">],</span>
        <span class="s1">&#39;C&#39;</span>   <span class="p">:</span> <span class="p">[</span><span class="mf">2.85e-4</span><span class="p">,</span> <span class="mf">2.84e-4</span><span class="p">,</span> <span class="mf">2.84e-4</span><span class="p">,</span> <span class="mf">2.74e-4</span><span class="p">,</span> <span class="mf">2.57e-4</span><span class="p">,</span> <span class="mf">2.38e-4</span><span class="p">,</span> <span class="mf">2.04e-4</span><span class="p">,</span> <span class="mf">1.60e-4</span><span class="p">,</span> <span class="mf">1.12e-4</span><span class="p">,</span>
                 <span class="mf">6.37e-5</span><span class="p">,</span> <span class="mf">5.07e-5</span><span class="p">,</span> <span class="mf">4.49e-5</span><span class="p">],</span>         
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>The following cell converts the data dictionary of experimental data to a Pandas dataframe then prints the result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">expt</span><span class="p">])</span> <span class="k">for</span> <span class="n">expt</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Expt&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>            C0    T         C
Expt                         
A     0.000164  423  0.000166
A     0.000164  449  0.000166
A     0.000164  471  0.000159
A     0.000164  495  0.000137
A     0.000164  518  0.000089
A     0.000164  534  0.000056
A     0.000164  549  0.000030
A     0.000164  563  0.000017
B     0.000369  423  0.000373
B     0.000369  446  0.000372
B     0.000369  469  0.000359
B     0.000369  490  0.000326
B     0.000369  507  0.000279
B     0.000369  523  0.000206
B     0.000369  539  0.000127
B     0.000369  553  0.000076
B     0.000369  575  0.000038
C     0.000287  443  0.000285
C     0.000287  454  0.000284
C     0.000287  463  0.000284
C     0.000287  475  0.000274
C     0.000287  485  0.000257
C     0.000287  497  0.000238
C     0.000287  509  0.000204
C     0.000287  520  0.000160
C     0.000287  534  0.000112
C     0.000287  545  0.000064
C     0.000287  555  0.000051
C     0.000287  568  0.000045
</pre></div>
</div>
</div>
</div>
<p>It’s generally a good idea to create some initial displays of the experimental data before attempting to fit a mathematical model. This provides an opportunity to identify potential problems with data, observe key features, and look for particular symmetries or patterns in the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">expt</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">expt</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="n">expt</span><span class="p">])</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;temperature / K&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;concentration&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;Expt. &quot;</span> <span class="o">+</span> <span class="n">expt</span> <span class="k">for</span> <span class="n">expt</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">))])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Effluent Concentrations&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8e05e57289817b3743652d3d330cf3583813c9a83b897340969a129087b650e7.png" src="../_images/8e05e57289817b3743652d3d330cf3583813c9a83b897340969a129087b650e7.png" />
</div>
</div>
<p>An initial plot of the data shows the effluent concentration decreases at higher operating temperatures. This indicates higher conversion at higher temperatures. A plot of conversion <code class="docutils literal notranslate"><span class="pre">X</span></code></p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
X &amp; = \frac{C_0 - C}{C_0}
\end{align*}
\]</div>
<p>collapses the data into a what appears to be a single function of temperature. The following cell adds conversion as an additional column of the data set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add a column &#39;X&#39; to the dataframe</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">expt</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">expt</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">expt</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Temperature (K)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;conversion ratios&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;C0 = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">][</span><span class="n">expt</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">expt</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">))])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Conversion at different feed concentrations&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d92d0aca86311cd7165bee64aa8f2125de9a5a863edd6914126162cd5444ff89.png" src="../_images/d92d0aca86311cd7165bee64aa8f2125de9a5a863edd6914126162cd5444ff89.png" />
</div>
</div>
</section>
<section id="step-2-select-a-model">
<h2><span class="section-number">7.1.4. </span>Step 2. Select a model<a class="headerlink" href="#step-2-select-a-model" title="Link to this heading">#</a></h2>
<p>A proposed steady-state model for the catalytic reactor is</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
0 &amp; = (C_0 - C) - \frac{m}{q} k_0 C^n\left(\frac{T}{T_r}\right)^n e^{-\frac{E_a}{R T_r }\frac{T_r}{T}}
\end{align*}
\]</div>
<p>The known parameters are the flow rate <span class="math notranslate nohighlight">\(q\)</span>, the mass of catalysit <span class="math notranslate nohighlight">\(m\)</span>, and a reference temperature <span class="math notranslate nohighlight">\(T_r\)</span>. The ratio <span class="math notranslate nohighlight">\(\frac{T}{T_r}\)</span> is the ‘reduced temperature’ and provides for a better conditioned equation. The unknown parameters are the reaction order <span class="math notranslate nohighlight">\(n\)</span>, the Arrhenius pre-exponental factor <span class="math notranslate nohighlight">\(k_0\)</span>, and the reduced activation energy <span class="math notranslate nohighlight">\(\frac{E_a}{R T_r}\)</span>. Generally the pre-exponential factor is very large, therefore is combined within the exponential term as <span class="math notranslate nohighlight">\(\ln k_0\)</span>.</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
0 &amp; = (C_0 - C) - \frac{m}{q} C^n\left(\frac{T}{T_r}\right)^n e^{\ln k_0-\frac{E_a}{R T_r }\frac{T_r}{T}}
\end{align*}
\]</div>
<p>The unknown parameters are:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Parameter</p></th>
<th class="head text-left"><p>Code</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><span class="math notranslate nohighlight">\(n\)</span></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">n</span></code></p></td>
<td class="text-left"><p>reaction order</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><span class="math notranslate nohighlight">\(\ln k_0\)</span></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">lnk0</span></code></p></td>
<td class="text-left"><p>natural log of Arrenhius pre-exponential factor</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><span class="math notranslate nohighlight">\(\frac{E_a}{R T_r}\)</span></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ERTr</span></code></p></td>
<td class="text-left"><p>reduced activation energy</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="step-3-define-a-figure-of-merit">
<h2><span class="section-number">7.1.5. </span>Step 3. Define a “figure of merit”<a class="headerlink" href="#step-3-define-a-figure-of-merit" title="Link to this heading">#</a></h2>
<p>Each experimental measure consists of values of the unknown parameters and experimental values <span class="math notranslate nohighlight">\(C_{0,k}\)</span>, <span class="math notranslate nohighlight">\(T_k\)</span>, and <span class="math notranslate nohighlight">\(C_k\)</span>. Given estimates for the unknown parameters, the model equation provides a convenient definition of a residual <span class="math notranslate nohighlight">\(r_k\)</span> as</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
r_k &amp; = C_{0,k} - C_k - \frac{m}{q} C^n\left(\frac{T_k}{T_r}\right)^n e^{\ln k_0-\frac{E_a}{R T_r }\frac{T_r}{T_k}}
\end{align*}
\]</div>
<p>If the model is an accurate depiction of the reaction processes then we expect the residuals to be small, random variates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Tr</span> <span class="o">=</span> <span class="mi">298</span>    <span class="c1"># reference temperature.</span>
<span class="n">q</span> <span class="o">=</span> <span class="mf">0.1</span>     <span class="c1"># flow rate (liters/min)</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>       <span class="c1"># amount of catalyst (g)</span>

<span class="k">def</span> <span class="nf">residuals</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">lnk0</span><span class="p">,</span> <span class="n">ERTr</span> <span class="o">=</span> <span class="n">parameters</span>
    <span class="n">C0</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">C0</span> <span class="o">-</span> <span class="n">C</span> <span class="o">-</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">C</span><span class="o">**</span><span class="n">n</span>  <span class="o">*</span> <span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">Tr</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lnk0</span> <span class="o">-</span> <span class="n">ERTr</span><span class="o">*</span><span class="n">Tr</span><span class="o">/</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To illustrate, the following cell calculates the residuals for an initial estimate for the unknown parameter values. The residuals are then plotted as a function of the experimental variables to see if the residuals behave as random variates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parameter_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;lnk0&#39;</span><span class="p">,</span> <span class="s1">&#39;ERTr&#39;</span><span class="p">]</span>
<span class="n">parameter_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">38</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">plot_residuals</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rmax</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">rmax</span><span class="p">,</span> <span class="n">rmax</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]))</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span> 
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">residuals</span><span class="p">(</span><span class="n">parameter_guess</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="n">plot_residuals</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/16669964fa9d38d7b30e17a1b93f28133fd477c9a22d5b1ae0e083fc82646a49.png" src="../_images/16669964fa9d38d7b30e17a1b93f28133fd477c9a22d5b1ae0e083fc82646a49.png" />
</div>
</div>
</section>
<section id="step-4-find-a-best-fit">
<h2><span class="section-number">7.1.6. </span>Step 4. Find a best fit<a class="headerlink" href="#step-4-find-a-best-fit" title="Link to this heading">#</a></h2>
<p>A least squares ‘figure of merit’ for the fit of the model to the experimental data is given by</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
SOS &amp; = \sum_k r_k^2
\end{align*}
\]</div>
<p>Our goal is to find values for the unknown parameters that minimize the sum of the squares of the residuals.</p>
<p>The following cell defines two functions. The first is <code class="docutils literal notranslate"><span class="pre">sos</span></code> which calculates the sum of squares of the residuals. The <code class="docutils literal notranslate"><span class="pre">best_fit</span></code> function uses <code class="docutils literal notranslate"><span class="pre">scipy.optimize.fmin</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sos</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">residuals</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">best_fit</span><span class="p">(</span><span class="n">fcn</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span><span class="n">fcn</span><span class="p">,</span> <span class="n">parameter_guess</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">df</span><span class="p">,),</span> <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">)</span>

<span class="n">parameter_fit</span> <span class="o">=</span> <span class="n">best_fit</span><span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">parameter_names</span><span class="p">,</span> <span class="n">parameter_fit</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot; = &quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization terminated successfully.
         Current function value: 0.000000
         Iterations: 140
         Function evaluations: 257
n  =  0.65
lnk0  =  13.65
ERTr  =  34.21
</pre></div>
</div>
</div>
</div>
<p>Let’s compare how the residuals have been reduced as a result of minimizing the sum of squares.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plot_residuals</span><span class="p">(</span><span class="n">residuals</span><span class="p">(</span><span class="n">parameter_guess</span><span class="p">,</span> <span class="n">df</span><span class="p">),</span> <span class="n">df</span><span class="p">)</span>
<span class="n">plot_residuals</span><span class="p">(</span><span class="n">residuals</span><span class="p">(</span><span class="n">parameter_fit</span><span class="p">,</span> <span class="n">df</span><span class="p">),</span> <span class="n">df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/16669964fa9d38d7b30e17a1b93f28133fd477c9a22d5b1ae0e083fc82646a49.png" src="../_images/16669964fa9d38d7b30e17a1b93f28133fd477c9a22d5b1ae0e083fc82646a49.png" />
<img alt="../_images/36a6aef0e4bb62a53646f33c928a11d693444243ccf55f1bc4f59988d875f19a.png" src="../_images/36a6aef0e4bb62a53646f33c928a11d693444243ccf55f1bc4f59988d875f19a.png" />
</div>
</div>
</section>
<section id="step-5-evaluate-the-goodness-of-fit">
<h2><span class="section-number">7.1.7. </span>Step 5. Evaluate the goodness of fit<a class="headerlink" href="#step-5-evaluate-the-goodness-of-fit" title="Link to this heading">#</a></h2>
<section id="plotting-residuals">
<h3><span class="section-number">7.1.7.1. </span>Plotting residuals<a class="headerlink" href="#plotting-residuals" title="Link to this heading">#</a></h3>
<p>An important element of any parameter fitting exercise is to examine the residuals for systematic errors. The following cell plots the residuals as functions of .</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">residuals</span><span class="p">(</span><span class="n">parameter_fit</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="n">plot_residuals</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">df</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/36a6aef0e4bb62a53646f33c928a11d693444243ccf55f1bc4f59988d875f19a.png" src="../_images/36a6aef0e4bb62a53646f33c928a11d693444243ccf55f1bc4f59988d875f19a.png" />
</div>
</div>
<p>It’s apparent that there is systematic error in the residuals.  To cause the minimizer to put more weight on those large residuals, a scaling factor is introduced into the norm used to measure the residual for the purpose of parameter estimation.</p>
</section>
<section id="separable-model">
<h3><span class="section-number">7.1.7.2. </span>Separable model<a class="headerlink" href="#separable-model" title="Link to this heading">#</a></h3>
<p>An interesting feature of the model for the catalytic reactor is that it can be separated into two sides such that the right-hand side is a function only of <span class="math notranslate nohighlight">\(T\)</span>.</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
\frac{C_{0} - C}{C^n} &amp; = \frac{m}{q} \left(\frac{T}{T_r}\right)^n e^{\ln k_0 -\frac{E_a}{R T_r }\frac{T_r}{T}}
\end{align*}
\]</div>
<p>Note that the left-hand side is a function of two independent experimental variables. But if the model accurately represents experimental behavior, then a plot of the left-hand side versus temperature should collapse to a single curve.</p>
<p>The next cell plots the experimental data as pairs <span class="math notranslate nohighlight">\((x_k, y_k)\)</span> where</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
x_k &amp; = \frac{C_{0,k} - C_k}{C_k^n}\\
y_k &amp; = \frac{m}{q} \left(\frac{T_k}{T_r}\right)^n e^{\ln k_0 -\frac{E_a}{R T_r }\frac{T_r}{T_k}}\\
\end{align*}
\end{split}\]</div>
<p>If the fitted model is an accurate representation of the catalytic reactor, then the data should collapse to single curve aligned with diagonal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="p">,</span> <span class="n">lnk0</span><span class="p">,</span> <span class="n">ERTr</span> <span class="o">=</span> <span class="n">parameter_fit</span>
<span class="k">for</span> <span class="n">expt</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">][</span><span class="n">expt</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="n">expt</span><span class="p">])</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="n">expt</span><span class="p">]</span><span class="o">**</span><span class="n">n</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">expt</span><span class="p">]</span><span class="o">/</span><span class="n">Tr</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lnk0</span> <span class="o">-</span> <span class="n">ERTr</span><span class="o">*</span><span class="n">Tr</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">expt</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(),</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$y_k$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x_k$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1b79e6e0f02515e607a4e9eaed5e655307350bfe6d4accbc51c754ae84c5299b.png" src="../_images/1b79e6e0f02515e607a4e9eaed5e655307350bfe6d4accbc51c754ae84c5299b.png" />
</div>
</div>
<p>Substituting <span class="math notranslate nohighlight">\(C = C_0(1-X)\)</span></p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
\frac{X}{(1-X)^n}\frac{1}{C_0^{n-1}} &amp; = \frac{m}{q} \left(\frac{T}{T_r}\right)^n e^{\ln k_0 -\frac{E_a}{R T_r }\frac{T_r}{T}}
\end{align*}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">expt</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">][</span><span class="n">expt</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">expt</span><span class="p">]</span><span class="o">/</span><span class="n">Tr</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lnk0</span> <span class="o">-</span> <span class="n">ERTr</span><span class="o">*</span><span class="n">Tr</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">expt</span><span class="p">])</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">expt</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="n">expt</span><span class="p">])</span><span class="o">**</span><span class="n">n</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(),</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d5062a9a8d4eee371ee0713a8caf81ddc9672455de619fa846ca64093f7b8fdd.png" src="../_images/d5062a9a8d4eee371ee0713a8caf81ddc9672455de619fa846ca64093f7b8fdd.png" />
</div>
</div>
</section>
</section>
<section id="step-6-estimate-confidence-intervals">
<h2><span class="section-number">7.1.8. </span>Step 6. Estimate confidence intervals<a class="headerlink" href="#step-6-estimate-confidence-intervals" title="Link to this heading">#</a></h2>
<p>The following cell implements a simple bootstrap method for estimating confidence intervals for the fitted parameters. The function <code class="docutils literal notranslate"><span class="pre">resample</span></code> creates a new dataframe of data by sampling (with replacement) the original experimental data.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">best_fit</span></code> function is called <code class="docutils literal notranslate"><span class="pre">N</span></code> times on resampled data sets to create a statistical sample of fitted parameters. Those results are analyzed using statistical functions from the Pandas library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">resample</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)),</span> <span class="n">k</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))]</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">best_fit</span><span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">resample</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)],</span> <span class="n">columns</span><span class="o">=</span><span class="n">parameter_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean values and 95</span><span class="si">% c</span><span class="s1">onfidence interval&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">dp</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s2">&quot; = &quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot; +/- &quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="mf">1.96</span><span class="o">*</span><span class="n">dp</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span>

<span class="n">dp</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Quantiles&quot;</span><span class="p">)</span>
<span class="n">dp</span><span class="o">.</span><span class="n">quantile</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean values and 95% confidence interval
n  =  0.68  +/-  0.2
lnk0  =  14.46  +/-  5.13
ERTr  =  35.27  +/-  6.69


Quantiles
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0.05</th>
      <th>0.50</th>
      <th>0.95</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>n</th>
      <td>0.563790</td>
      <td>0.666206</td>
      <td>0.814233</td>
    </tr>
    <tr>
      <th>lnk0</th>
      <td>11.050461</td>
      <td>14.096802</td>
      <td>18.641407</td>
    </tr>
    <tr>
      <th>ERTr</th>
      <td>30.632469</td>
      <td>34.671630</td>
      <td>41.664595</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="../_images/97b19bd933018f8f6576e0f4e3c47c7ea557ebf593a8d1d1127416f6d696c762.png" src="../_images/97b19bd933018f8f6576e0f4e3c47c7ea557ebf593a8d1d1127416f6d696c762.png" />
</div>
</div>
</section>
<section id="step-7-determine-if-a-better-fit-is-possible">
<h2><span class="section-number">7.1.9. </span>Step 7. Determine if a better fit is possible<a class="headerlink" href="#step-7-determine-if-a-better-fit-is-possible" title="Link to this heading">#</a></h2>
<p>In this section we introduce an alternative method of coding solutions to parameter estimation problems using Pyomo. An advantage of using Pyomo is the more explicit indentification of unknown parameters, objective, and constraints on parameter values.</p>
<section id="pyomo-model-version-1">
<h3><span class="section-number">7.1.9.1. </span>Pyomo model - version 1<a class="headerlink" href="#pyomo-model-version-1" title="Link to this heading">#</a></h3>
<p>The first version of a Pyomo model for estimating parameters for the catalytic reactor is a direct translation of the approach outlined above. There are some key coding considerations in performing this translation to a Pyomo model:</p>
<ul class="simple">
<li><p>As of the current version of Pyomo, an optimization variable cannot appear in the exponent of an expresson. The workaound is to recognize $<span class="math notranslate nohighlight">\( C^n = e^{n \ln C}\)</span>$</p></li>
<li><p>The residuals are expressed as a list of Pyomo expressions.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Tr</span> <span class="o">=</span> <span class="mi">298</span>    <span class="c1"># The reference temperature.</span>
<span class="n">q</span> <span class="o">=</span> <span class="mf">0.1</span>     <span class="c1"># The flow rate (liters/min)</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>       <span class="c1"># The amount of catalyst (g)</span>

<span class="k">def</span> <span class="nf">pyomo_fit1</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">T</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
    <span class="n">C</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">])</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">])</span>

    <span class="n">mdl</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">()</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">n</span>    <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">lnk0</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">ERTr</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mi">38</span><span class="p">)</span>
    
    <span class="n">residuals</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">C0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">Tr</span><span class="p">))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">lnk0</span> <span class="o">-</span> <span class="n">mdl</span><span class="o">.</span><span class="n">ERTr</span><span class="o">*</span><span class="n">Tr</span><span class="o">/</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">))]</span>

    <span class="n">mdl</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">))),</span> <span class="n">sense</span><span class="o">=</span><span class="n">minimize</span><span class="p">)</span>
    <span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;ipopt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">mdl</span><span class="o">.</span><span class="n">n</span><span class="p">(),</span> <span class="n">mdl</span><span class="o">.</span><span class="n">lnk0</span><span class="p">(),</span> <span class="n">mdl</span><span class="o">.</span><span class="n">ERTr</span><span class="p">()],</span> <span class="p">[</span><span class="n">residuals</span><span class="p">[</span><span class="n">k</span><span class="p">]()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">))]</span>

<span class="n">parameter_values_1</span><span class="p">,</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">pyomo_fit1</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">plot_residuals</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">parameter_names</span><span class="p">,</span> <span class="n">parameter_values_1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot; = &quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>n  =  0.65
lnk0  =  13.65
ERTr  =  34.21
</pre></div>
</div>
<img alt="../_images/3508f8e1fffe483df8e6490f28b04d0701081b4b4098563dacd5962e8cc39198.png" src="../_images/3508f8e1fffe483df8e6490f28b04d0701081b4b4098563dacd5962e8cc39198.png" />
</div>
</div>
</section>
<section id="pyomo-model-version-2">
<h3><span class="section-number">7.1.9.2. </span>Pyomo model - version 2<a class="headerlink" href="#pyomo-model-version-2" title="Link to this heading">#</a></h3>
<p>As a second model we consider a somewhat simpler model that omits the temperature dependence of the Arrhenius pre-exponential factor:</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
0 &amp; = C_0 - C - \frac{m}{q} C^n e^{\ln k_0-\frac{E_a}{R T_r }\frac{T_r}{T}}
\end{align*}
\]</div>
<p>Can this somewhat simpler model adequately fit the data?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Tr</span> <span class="o">=</span> <span class="mi">298</span>    <span class="c1"># The reference temperature.</span>
<span class="n">q</span> <span class="o">=</span> <span class="mf">0.1</span>     <span class="c1"># The flow rate (liters/min)</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>       <span class="c1"># The amount of catalyst (g)</span>

<span class="k">def</span> <span class="nf">pyomo_fit2</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">T</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
    <span class="n">C</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">])</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">])</span>

    <span class="n">mdl</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">()</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">n</span>    <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">lnk0</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">ERTr</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mi">38</span><span class="p">)</span>
    
    <span class="n">residuals</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">C0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">lnk0</span> <span class="o">-</span> <span class="n">mdl</span><span class="o">.</span><span class="n">ERTr</span><span class="o">*</span><span class="n">Tr</span><span class="o">/</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">))]</span>

    <span class="n">mdl</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">))),</span> <span class="n">sense</span><span class="o">=</span><span class="n">minimize</span><span class="p">)</span>
    <span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;ipopt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">mdl</span><span class="o">.</span><span class="n">n</span><span class="p">(),</span> <span class="n">mdl</span><span class="o">.</span><span class="n">lnk0</span><span class="p">(),</span> <span class="n">mdl</span><span class="o">.</span><span class="n">ERTr</span><span class="p">()],</span> <span class="p">[</span><span class="n">residuals</span><span class="p">[</span><span class="n">k</span><span class="p">]()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">))]</span>

<span class="n">parameter_values_2</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">pyomo_fit2</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">plot_residuals</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">parameter_names</span><span class="p">,</span> <span class="n">parameter_values_2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot; = &quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>n  =  0.65
lnk0  =  14.69
ERTr  =  35.4
</pre></div>
</div>
<img alt="../_images/b51805fefeffdc1671b3b788770603365ff0a2d7acf99e4563f5c2a90d0da827.png" src="../_images/b51805fefeffdc1671b3b788770603365ff0a2d7acf99e4563f5c2a90d0da827.png" />
</div>
</div>
<p>Is there a meaningful difference between these two models?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plot_residuals</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="n">plot_residuals</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b51805fefeffdc1671b3b788770603365ff0a2d7acf99e4563f5c2a90d0da827.png" src="../_images/b51805fefeffdc1671b3b788770603365ff0a2d7acf99e4563f5c2a90d0da827.png" />
<img alt="../_images/3508f8e1fffe483df8e6490f28b04d0701081b4b4098563dacd5962e8cc39198.png" src="../_images/3508f8e1fffe483df8e6490f28b04d0701081b4b4098563dacd5962e8cc39198.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;temperature dependent pre-exponential&#39;</span><span class="p">,</span> <span class="s1">&#39;no temperature dependent pre-exponential&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fb57e799250&gt;
</pre></div>
</div>
<img alt="../_images/de4a300fdbb2fe3b01181f08d9ef7ad80c98503eeca907201c5a9eaf0e73a53d.png" src="../_images/de4a300fdbb2fe3b01181f08d9ef7ad80c98503eeca907201c5a9eaf0e73a53d.png" />
</div>
</div>
<p>Based on this analysis of residuals, there is very little statistical support for a temperature dependent Arrhenius pre-exponential factor. Generally speaking, in situations like this it is generally wise to go with the simplist (i.e, most parsimonious) model that can adequately explain the data.</p>
</section>
<section id="pyomo-model-version-3">
<h3><span class="section-number">7.1.9.3. </span>Pyomo model - version 3<a class="headerlink" href="#pyomo-model-version-3" title="Link to this heading">#</a></h3>
<p>Is the reaction <span class="math notranslate nohighlight">\(n^{th}\)</span> order, or could it be satisfactorily approximated with first-order kinetics?</p>
<div class="math notranslate nohighlight">
\[
\begin{align*}
0 &amp; = C_0 - C - \frac{m}{q} C e^{\ln k_0-\frac{E_a}{R T_r }\frac{T_r}{T}}
\end{align*}
\]</div>
<p>The following cell adds a constraint to force <span class="math notranslate nohighlight">\(n=1\)</span>. We’ll then examine the residuals to test if there is a statistically meaningful difference between the case <span class="math notranslate nohighlight">\(n=1\)</span> and <span class="math notranslate nohighlight">\(n \ne 1\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Tr</span> <span class="o">=</span> <span class="mi">298</span>    <span class="c1"># The reference temperature.</span>
<span class="n">q</span> <span class="o">=</span> <span class="mf">0.1</span>     <span class="c1"># The flow rate (liters/min)</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>       <span class="c1"># The amount of catalyst (g)</span>

<span class="k">def</span> <span class="nf">pyomo_fit3</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">T</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
    <span class="n">C</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">])</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">])</span>

    <span class="n">mdl</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">()</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">n</span>    <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">lnk0</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">ERTr</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="mi">38</span><span class="p">)</span>
    
    <span class="n">residuals</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">C0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">lnk0</span> <span class="o">-</span> <span class="n">mdl</span><span class="o">.</span><span class="n">ERTr</span><span class="o">*</span><span class="n">Tr</span><span class="o">/</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">))]</span>

    <span class="n">mdl</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">))),</span> <span class="n">sense</span><span class="o">=</span><span class="n">minimize</span><span class="p">)</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">con</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;ipopt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">mdl</span><span class="o">.</span><span class="n">n</span><span class="p">(),</span> <span class="n">mdl</span><span class="o">.</span><span class="n">lnk0</span><span class="p">(),</span> <span class="n">mdl</span><span class="o">.</span><span class="n">ERTr</span><span class="p">()],</span> <span class="p">[</span><span class="n">residuals</span><span class="p">[</span><span class="n">k</span><span class="p">]()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">))]</span>

<span class="n">parameter_values_3</span><span class="p">,</span> <span class="n">r3</span> <span class="o">=</span> <span class="n">pyomo_fit3</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">plot_residuals</span><span class="p">(</span><span class="n">r3</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">parameter_names</span><span class="p">,</span> <span class="n">parameter_values_3</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot; = &quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>n  =  1.0
lnk0  =  23.01
ERTr  =  44.59
</pre></div>
</div>
<img alt="../_images/19c944f47c378af1b5956471f759ecb938d6154d235818b1b6bfa591e985f445.png" src="../_images/19c944f47c378af1b5956471f759ecb938d6154d235818b1b6bfa591e985f445.png" />
</div>
</div>
<p>Comparing to models above, we see that restricting <span class="math notranslate nohighlight">\(n=1\)</span> does lead to somewhat larger residuals.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plot_residuals</span><span class="p">(</span><span class="n">r3</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="n">plot_residuals</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/19c944f47c378af1b5956471f759ecb938d6154d235818b1b6bfa591e985f445.png" src="../_images/19c944f47c378af1b5956471f759ecb938d6154d235818b1b6bfa591e985f445.png" />
<img alt="../_images/b51805fefeffdc1671b3b788770603365ff0a2d7acf99e4563f5c2a90d0da827.png" src="../_images/b51805fefeffdc1671b3b788770603365ff0a2d7acf99e4563f5c2a90d0da827.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">r3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;nth order kinetics&#39;</span><span class="p">,</span> <span class="s1">&#39;first order kinetics&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3d5d0e5ee8808eac59fb3a10d9868b8cde8ab96cad395dac13959c6a872cf960.png" src="../_images/3d5d0e5ee8808eac59fb3a10d9868b8cde8ab96cad395dac13959c6a872cf960.png" />
</div>
</div>
</section>
<section id="f-ratio-test">
<h3><span class="section-number">7.1.9.4. </span>F-ratio test<a class="headerlink" href="#f-ratio-test" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">3</span>  <span class="c1"># degrees of freedom after fitting 3 parameters</span>

<span class="n">r3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r3</span><span class="p">)</span>
<span class="n">df3</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">3</span>  <span class="c1"># degrees of freedom after fitting 2 parameters</span>

<span class="n">Fratio</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="o">/</span><span class="n">r3</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>

<span class="n">pvalue</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">Fratio</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">df3</span><span class="p">)</span>

<span class="k">if</span> <span class="n">pvalue</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot reject hypothesis that the variances are equal at p=0.05: Test pvalue = &quot;</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cannot reject hypothesis that the variances are equal at p=0.05: Test pvalue =  0.13297014615598618
</pre></div>
</div>
</div>
</div>
</section>
<section id="levene-test">
<h3><span class="section-number">7.1.9.5. </span>Levene test<a class="headerlink" href="#levene-test" title="Link to this heading">#</a></h3>
<p>The <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.levene.html">Levene test</a> provides a more robust test for the null hypothesis that samples are from populations with equal variances.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">levene</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">r3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LeveneResult(statistic=0.3449520288649278, pvalue=0.559345414685297)
</pre></div>
</div>
</div>
</div>
<p>The Levene statistic means that we cannot rule out that the residuals of these models have different variances. Consequently we do not have statistically meaningful evidence that the order of the reaction is different from <span class="math notranslate nohighlight">\(n=1\)</span>.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="07.00-Parameter-Estimation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Parameter Estimation</p>
      </div>
    </a>
    <a class="right-next"
       href="08.00-Financial-Applications.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">8. </span>Financial Applications</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">7.1.1. Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#steps-in-model-fitting">7.1.2. Steps in model fitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-the-data">7.1.3. Step 1. The data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-select-a-model">7.1.4. Step 2. Select a model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-define-a-figure-of-merit">7.1.5. Step 3. Define a “figure of merit”</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-find-a-best-fit">7.1.6. Step 4. Find a best fit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-evaluate-the-goodness-of-fit">7.1.7. Step 5. Evaluate the goodness of fit</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-residuals">7.1.7.1. Plotting residuals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#separable-model">7.1.7.2. Separable model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-6-estimate-confidence-intervals">7.1.8. Step 6. Estimate confidence intervals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-7-determine-if-a-better-fit-is-possible">7.1.9. Step 7. Determine if a better fit is possible</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pyomo-model-version-1">7.1.9.1. Pyomo model - version 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pyomo-model-version-2">7.1.9.2. Pyomo model - version 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pyomo-model-version-3">7.1.9.3. Pyomo model - version 3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#f-ratio-test">7.1.9.4. F-ratio test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#levene-test">7.1.9.5. Levene test</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jeffrey C. Kantor
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>